
<md-list class="zp-messages-list" zpScrollGlue [class.empty]="conversation?.messages.length === 0">
  <h4 md-list-empty *ngIf="conversation?.messages.length === 0">0 messages</h4>

  <md-list-item *ngFor="let message of conversation?.messages; let $index = index; trackBy: trackByMessageId;"
      (mouseenter)="onMouseEnterMessage($event, message, $index)"
      (mouseleave)="onMouseLeaveMessage($event, message, $index)"
      (click)="onClickMessage($event, message, $index)" [ngClass]="[message.type]"
      [class.owner]="message.isOwner" [class.precede]="message.isPrecede" [class.hovered]="message.isHovered">
    <zp-avatar md-list-avatar [user]="message.user" [size]="40"></zp-avatar>

    <h3 md-line> {{message.user.firstname}} </h3>

    <p md-line>
      <span md-list-markup *ngIf="message.type == 'markup'" [innerHTML]="message.value"></span>

      <template [ngIf]="message.type == 'attachment'">
        <div md-list-file *ngIf="message.metadata.type != 'image'">
          <div [ngSwitch]="message.metadata.extension">
            <md-icon *ngSwitchDefault>insert_drive_file</md-icon>
            <md-icon *ngSwitchCase="'video'">play_circle_filled</md-icon>
            <md-icon *ngSwitchCase="'audio'">audiotrack</md-icon>  
          </div>        
          <span>
            <p><span>Name:</span> {{message.metadata.name}}</p>
            <p><span>Type:</span> {{message.metadata.contentType}}</p>
            <p><span>Size:</span> {{message.metadata.size}}</p>
          </span>
        </div>
        <img md-list-image *ngIf="message.metadata.type == 'image'" [src]="message.value">
      </template>
    </p>

    <span md-list-date *ngIf="message.isHovered" [@timestampAnimation]="message.isHovered" title="{{ message.timeFromNow }}" 
          (mouseenter)="message.getTimeFromNow()">
      {{ message.date | date:'HH:mm:ss' }}
    </span>
  </md-list-item>
</md-list>

<md-toolbar class="zp-messages-inputs flex-centered">
  <md-progress-bar *ngIf="progress > 0" mode="determinate" value="{{progress}}"></md-progress-bar>
  
  <div class="zp-input-files">
    <button type="button" md-icon-button color="primary" (click)="inputFileClick()">
      <md-icon>file_upload</md-icon>
    </button>
    <input #uploadInput type="file" ng2FileSelect capture="camera" [uploader]="uploader" [multiple]="multiple" (change)="onSelectAttachment($event)"/>
  </div> 

  <form (ngSubmit)="addMessage($event)" #messageForm="ngForm" id="messageForm">
    <md-input #messageRawDom [(ngModel)]="messageRaw" class="zp-messages-inputs-text" maxlength="{{limits.message}}" name="messageRawDom" id="messageRawDom" required autocomplete="off">
      <md-hint align="end">{{messageRawDom.characterCount > 0 ? messageRawDom.characterCount : '' }}</md-hint>
    </md-input>
  </form>

  <button type="submit" md-icon-button color="primary" form="messageForm">
    <md-icon>send</md-icon>
  </button>

  <!--<button type="button" md-icon-button color="primary">
    <md-icon>sentiment_satisfied</md-icon>
  </button>-->
</md-toolbar>

<div class="zp-messages-dropzone" *ngIf="dropZoneActive" [@dropZoneAnimation]="dropZoneActive"
     ng2FileDrop [uploader]="uploader"(fileOver)="onDropAttachment($event)" (dragleave)="onDropzoneLeave($event)">
  <div class="zp-messages-dropzone-content">
    <md-icon class="xl">file_upload</md-icon>
    <h4>Drop your files.</h4>
  </div>
</div>

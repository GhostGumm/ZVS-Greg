

<md-list class="zp-messages-list" zpScrollGlue>
  <md-list-item *ngFor="let message of messages; let $index = index; trackBy: trackByMessageId;"
      (mouseenter)="onMouseEnterMessage($event, message, $index)"
      (mouseleave)="onMouseLeaveMessage($event, message, $index)"
      (click)="onClickMessage($event, message, $index)"
      [class.owner]="message.owner" [class.precede]="message.precede" [class.hovered]="message.isHovered">
    <span md-list-avatar [ngStyle]="{'background-image': 'url(/assets/zetalk_logo.png)'}"></span>

    <h3 md-line> {{message.author}} </h3>

    <p md-line [ngSwitch]="message.type">
      <span *ngSwitchCase="'text'"> {{message.value}}</span>
      <img md-list-image *ngSwitchCase="'image'" [src]="message.value">
      <span md-list-attachment *ngSwitchCase="'attachment'" class="fa {{message.metadata.class}}">{{message.metadata.type}}</span>
    </p>

    <span md-list-date *ngIf="message.isHovered" [@timestampAnimation]="message.isHovered">{{ message.date | date:"hh:mm" }}</span>
  </md-list-item>
</md-list>


<md-toolbar class="zp-messages-inputs flex-centered">  
  <md-progress-bar mode="determinate" value="{{uploader.progress}}"></md-progress-bar>

  <button class="zp-input-files" type="button" md-icon-button color="primary"> 
    <md-icon class="md-24">file_upload</md-icon>
    <input #uploadInput type="file" ng2FileSelect capture="camera" [uploader]="uploader" [multiple]="multiple" (change)="onSelectAttachment($event)"/>
  </button>

  <form (ngSubmit)="processInput()" #messageForm="ngForm" id="messageForm">
    <md-input #messageRaw [(ngModel)]="messageModel.raw" class="zp-messages-inputs-text" maxlength="{{limits.message}}" name="messageRaw" id="messageRaw" required>
      <!--<md-hint align="end">{{messageRaw.characterCount || 0}} / {{limits.message}}</md-hint>-->
    </md-input>
  </form>

  <button type="submit" md-icon-button color="primary" form="messageForm">
    <md-icon class="md-24">send</md-icon>
  </button> 

  <button type="button" md-icon-button color="primary">
    <md-icon class="md-24">sentiment_satisfied</md-icon>
  </button> 
</md-toolbar>

<div class="zp-messages-dropzone" ng2FileDrop [uploader]="uploader" *ngIf="dropZoneActive" [@dropZoneAnimation]="dropZoneActive"
  (fileOver)="onDropAttachment($event)" (dragleave)="onDropzoneLeave($event)">
  <div class="zp-messages-dropzone-content">
    <md-icon class="xl">file_upload</md-icon>
    <h4>Drop your files.</h4>
  </div>
</div>
